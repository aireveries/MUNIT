version: 1
kind: group

hptuning:
  concurrency: 30
  matrix:
    blockidx:
      range: '0:20:1'

environment:
  node_selector:
    aws/type: p3.2xlarge
  resources:
    gpu:
      requests: 1
      limits: 1

declarations:
  config: /mnt/outputs/thomas/skyfall/experiments/2501/outputs/max_iter=10000,image_save_iter=1000,snapshot_save_iter=1000,new_size=512,crop_image_height=512,crop_image_width=512/config.yaml
  synthetic_folder: /mnt/internal/skyfall
  real_glob: /mnt/clients/skyfall/512_tiles_strategy1/*/*/*.jpg
  checkpoint: /mnt/outputs/thomas/skyfall/experiments/2501/outputs/max_iter=10000,image_save_iter=1000,snapshot_save_iter=1000,new_size=512,crop_image_height=512,crop_image_width=512/checkpoints/gen_00004000.pt
  blocksize: 20
  nvar: 2
  outdir: /mnt/users/patrick/skyfall_munit_translated
  split_names: train_10 train_50 train_100 val
  root: /mnt/outputs/thomas/skyfall/experiments/2501

build:
  image: 'aireverie/munit:latest'
  branch: more_polyaxon_scripts

run:
  cmd: >-
    set -o noglob; python munit_translator.py
    --config {{ config }}
    --synthetic-folder {{ synthetic_folder }}
    --real-glob {{ real_glob }}
    --in-width 2560
    --in-height 1440
    --out-width 2560
    --out-height 1440
    --split_names {{ split_names }}
    --checkpoint {{ checkpoint }}
    --blocksize {{ blocksize }}
    --blockidx {{ blockidx }}
    --outdir {{ outdir }}
    --nvar {{ nvar }}
    --format coco